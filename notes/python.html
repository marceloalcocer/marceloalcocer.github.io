

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python &mdash; marceloalcocer.github.io v0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ReST" href="rest.html" />
    <link rel="prev" title="Packages" href="packages.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> marceloalcocer.github.io
          

          
          </a>

          
            
            
              <div class="version">
                v0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../notes.html">Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="backup.html">Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="bash.html">Bash</a></li>
<li class="toctree-l2"><a class="reference internal" href="c.html">C/C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="desktop.html">Desktop environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="eclipse.html">Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="gentoo.html">Gentoo</a></li>
<li class="toctree-l2"><a class="reference internal" href="git.html">Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpg.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphing.html">Graphing</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="lab_server.html">Lab server</a></li>
<li class="toctree-l2"><a class="reference internal" href="latex.html">LaTeX</a></li>
<li class="toctree-l2"><a class="reference internal" href="lu.html">Lund University</a></li>
<li class="toctree-l2"><a class="reference internal" href="network.html">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="packages.html">Packages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#async">async</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pip">pip</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation-from-source">Installation from source</a></li>
<li class="toctree-l4"><a class="reference internal" href="#privileged-installation">Privileged installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#package-locations">Package locations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#numpy">NumPy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#subclassing-ndarray">Subclassing ndarray</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pickling-ndarray-subclasses">Pickling ndarray subclasses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#subclassing-builtin-types">Subclassing builtin types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bokeh-plotting-library">Bokeh Plotting Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-status">Current Status</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ctypes-pointers">ctypes Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#matplotlib">matplotlib</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#updating">Updating</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backends">Backends</a></li>
<li class="toctree-l4"><a class="reference internal" href="#animation-output">Animation Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#svg-output">SVG Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scipy">SciPy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-scipy-components-on-linux">Upgrading SciPy Components on Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-scipy-on-windows">Installing SciPy on Windows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rest.html">ReST</a></li>
<li class="toctree-l2"><a class="reference internal" href="reveal_js.html">reveal.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="rtd.html">Read The Docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="signal.html">Signal processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="sphinx.html">Sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="ssh.html">SSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="vim.html">Vim</a></li>
<li class="toctree-l2"><a class="reference internal" href="vscode.html">Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html">Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows.html">Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ultrajs.html">ultrajs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sunfleet.html">Sunfleet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../svgfragments.html">SVGFragments</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">marceloalcocer.github.io</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../notes.html">Online margin scribbles…</a> &raquo;</li>
        
      <li>Python</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="python">
<h1>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h1>
<section id="async">
<h2>async<a class="headerlink" href="#async" title="Permalink to this headline">¶</a></h2>
<dl class="field-list simple">
<dt class="field-odd">Concept</dt>
<dd class="field-odd"><p>Relinquish <em>some</em> control of execution order to an event loop so as to enable concurrent (<em>not parallel</em>) execution (handing execution ‘baton’ amongst multiple blocking operations).</p>
</dd>
</dl>
<p>To achieve this, define <em>coroutines</em> using <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> — functions which can pause/resume execution. These are nothing magical, but rather just a formalization of some of the more advanced functionalities of generators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───────&gt;───────╮
│             ──┼─&gt; yield
┊   generator
│             &lt;─┼── send
╰───────&lt;───────╯
</pre></div>
</div>
<p>Within a coroutine, relinquish control using <code class="docutils literal notranslate"><span class="pre">await</span></code>. The controlling event loop will then re-enter the coroutine once the awaitable is ready:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>╭───────&gt;───────╮
│             ──┼─&gt; await
┊   coroutine                Event Loop
│             &lt;─┼── result
╰───────&lt;───────╯
</pre></div>
</div>
<p>N.b. Execution order is as normal in the coroutine — <code class="docutils literal notranslate"><span class="pre">await</span></code> blocks <em>within</em> coroutine. Concurrency is only achieved when multiple coroutines are being handled by the event loop.</p>
<p>Python does <em>not</em> have an in-built event loop, but rather only provides the basic tools (<code class="docutils literal notranslate"><span class="pre">async/await</span></code>) to do so. It’s envisaged that multiple libraries will implement them in different ways.</p>
<p>One such implementation bundled in the stdlib is <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> — a library focussing on asynchronous IO. <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>’s event loop is started using <code class="docutils literal notranslate"><span class="pre">asyncio.run()</span></code>. The argument is a coroutine which probably calls other coroutines. The called coroutines are added to and handled by the event loop. The event loop is closed once the main coroutine returns, e.g. <a class="footnote-reference brackets" href="#id2" id="id1">1</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">say_after</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;started at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">say_after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">say_after</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;finished at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>N.b. As mentioned above, the <code class="docutils literal notranslate"><span class="pre">await</span></code> in <code class="docutils literal notranslate"><span class="pre">main</span></code> is blocking, so execution order within <code class="docutils literal notranslate"><span class="pre">main</span></code> is well defined (first <code class="docutils literal notranslate"><span class="pre">await</span></code>, second <code class="docutils literal notranslate"><span class="pre">await</span></code>). As such, in this example only one coroutine is being handled by the event loop at a time, and so there is no real concurrency.</p>
<p>To achieve concurrency, must have multiple coroutines in event loop, i.e. single <code class="docutils literal notranslate"><span class="pre">await</span></code> on multiple coroutines. Do this in <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> by converting coroutines into <code class="docutils literal notranslate"><span class="pre">Task</span></code> instances (using <code class="docutils literal notranslate"><span class="pre">asyncio.create_task</span></code>). These will be scheduled for imminent execution in the event loop.</p>
<p>N.b. Execution will occur soon after the <code class="docutils literal notranslate"><span class="pre">Task</span></code> is instantiated. <code class="docutils literal notranslate"><span class="pre">Tasks</span></code> are however awaitables, and so <code class="docutils literal notranslate"><span class="pre">await</span></code> can be used if necessary to suspend control flow until the <code class="docutils literal notranslate"><span class="pre">Task</span></code> has completed. This can be used for example, to ensure the <code class="docutils literal notranslate"><span class="pre">Tasks</span></code> stay in scope:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">say_after</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">task1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">say_after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">))</span>      <span class="c1"># Will start executing imminently</span>
        <span class="n">task2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">say_after</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">))</span>      <span class="c1"># Will start executing imminently</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;started at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">task1</span>     <span class="c1"># Wait until task 1 is done…</span>
        <span class="k">await</span> <span class="n">task2</span>     <span class="c1"># …and then wait until task 2 is done</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;finished at </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Can also use <code class="docutils literal notranslate"><span class="pre">asyncio.gather</span></code> as convenient way to convert multiple coroutines into tasks — this is probably what you’ll be using most:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">say_after</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

        <span class="c1"># Convert both coroutines into tasks, thereby scheduling</span>
        <span class="c1"># their concurrent execution.</span>
        <span class="c1">#</span>
        <span class="c1"># Wait until both tasks have completed before proceeding</span>
        <span class="c1">#</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="n">say_after</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">),</span>
                <span class="n">say_after</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
        <span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3.7/library/asyncio-task.html">https://docs.python.org/3.7/library/asyncio-task.html</a></p>
</dd>
</dl>
</section>
<section id="pip">
<h2>pip<a class="headerlink" href="#pip" title="Permalink to this headline">¶</a></h2>
<section id="installation-from-source">
<h3>Installation from source<a class="headerlink" href="#installation-from-source" title="Permalink to this headline">¶</a></h3>
<p>Recommended way of installing python package from source is via pip <a class="footnote-reference brackets" href="#id4" id="id3">2</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="o">&lt;</span><span class="n">PATH</span><span class="o">&gt;</span>
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p><a class="reference external" href="https://packaging.python.org/tutorials/installing-packages/">https://packaging.python.org/tutorials/installing-packages/</a></p>
</dd>
</dl>
</section>
<section id="privileged-installation">
<h3>Privileged installation<a class="headerlink" href="#privileged-installation" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pip</span></code> is Python package manager used for installing packages from Python Package Index (PyPI) <a class="footnote-reference brackets" href="#id8" id="id5">3</a>. Typically bootstrap <code class="docutils literal notranslate"><span class="pre">pip</span></code> by installing it from external sources (e.g. Debian package using <code class="docutils literal notranslate"><span class="pre">apt</span></code>), and from then it can update itself.</p>
<p>Python packages are installed by running their <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> scripts. As such, very dangerous to call <code class="docutils literal notranslate"><span class="pre">pip</span></code> with superuser privileges — pulls code from PyPI (or elsewhere) and executes as superuser <a class="footnote-reference brackets" href="#id9" id="id6">4</a>! Should instead install as user using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code> <a class="footnote-reference brackets" href="#id10" id="id7">5</a>.</p>
<dl class="footnote brackets">
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id5">3</a></span></dt>
<dd><p><a class="reference external" href="https://en.wikipedia.org/wiki/Pip_(package_manager">https://en.wikipedia.org/wiki/Pip_(package_manager</a>)</p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id6">4</a></span></dt>
<dd><p><a class="reference external" href="https://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice">https://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice</a></p>
</dd>
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id7">5</a></span></dt>
<dd><p>Should be default pip behaviour on Ubuntu</p>
</dd>
</dl>
</section>
<section id="package-locations">
<h3>Package locations<a class="headerlink" href="#package-locations" title="Permalink to this headline">¶</a></h3>
<p>On Debian based distributions, Python packages are by default installed to 3 different locations (approx) <a class="footnote-reference brackets" href="#id12" id="id11">6</a>:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/lib/python3/dist-packages</span></code>: Global site-packages installed by Debian package manager. Typically required by the distribution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3.5/dist-packages</span></code>: Global site-packages installed by <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span></code>. Typically installed (incorrectly) by user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.local/lib/python3.5/site-packages</span></code>: User site-packages installed by <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span></code>. Typically installed by user.</p></li>
</ol>
<p>To see locations of installed packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="nb">list</span> <span class="o">-</span><span class="n">vvv</span>
</pre></div>
</div>
<p>Interestingly, <code class="docutils literal notranslate"><span class="pre">installer</span></code> column does not always show <code class="docutils literal notranslate"><span class="pre">pip</span></code> even if the package was installed with <code class="docutils literal notranslate"><span class="pre">pip</span></code>. Instead best to identify installation method by path.</p>
<p>To move packages erroneously installed as global packages to user packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
for x in $( pip3 list -vvv | grep &quot;/usr/local/lib/*&quot; | grep -o &quot;^\w*&quot; ); do
        pip show ${x}
        sudo pip uninstall ${x}
        pip install --user ${x}
        pip show ${x}
        pip list -vvv | grep &quot;/usr/local/lib/*&quot;
done
</pre></div>
</div>
<p>N.b. <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span></code> will ask for confirmation before uninstalling.</p>
<p>Whilst installing, pip automatically checks dependencies using both global and user packages. As such, moving a depending/dependent package from global to user should not break the dependency, and so the packages may be moved in any order. Should still check though:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">check</span>
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id11">6</a></span></dt>
<dd><p><a class="reference external" href="https://stackoverflow.com/questions/9387928/whats-the-difference-between-dist-packages-and-site-packages">https://stackoverflow.com/questions/9387928/whats-the-difference-between-dist-packages-and-site-packages</a></p>
</dd>
</dl>
</section>
</section>
<section id="numpy">
<h2>NumPy<a class="headerlink" href="#numpy" title="Permalink to this headline">¶</a></h2>
<section id="subclassing-ndarray">
<h3>Subclassing ndarray<a class="headerlink" href="#subclassing-ndarray" title="Permalink to this headline">¶</a></h3>
<p>Often desirable to subclass ndarray for numeric-based classes. Doing this correctly is slightly more complicated than regular subclassing as ndarray instances can be created in three different ways <a class="footnote-reference brackets" href="#id15" id="id13">7</a>:</p>
<ol class="arabic simple">
<li><p>Explicit constructor call: <code class="docutils literal notranslate"><span class="pre">MySubclass(params)</span></code></p></li>
<li><p>View casting: <code class="docutils literal notranslate"><span class="pre">np.array([1,2,3]).view(MySubclass)</span></code></p></li>
<li><p>Templating: <code class="docutils literal notranslate"><span class="pre">MySubclass([1,2,3])[1:]</span></code></p></li>
</ol>
<p>Each builds instances with slightly different calls to <code class="docutils literal notranslate"><span class="pre">__new__</span></code>, <code class="docutils literal notranslate"><span class="pre">__init__</span></code> and <code class="docutils literal notranslate"><span class="pre">__array_finalize__</span></code>. Briefly:</p>
<ul class="simple">
<li><p>All methods call subclass’s <code class="docutils literal notranslate"><span class="pre">__new__</span></code> method where must have superclass <code class="docutils literal notranslate"><span class="pre">np.ndarray.__new__</span></code> call</p></li>
<li><p>This triggers call to subclass’s <code class="docutils literal notranslate"><span class="pre">__array_finalize__</span></code> method</p></li>
<li><p>Arguments to <code class="docutils literal notranslate"><span class="pre">__array_finalize__</span></code> are different for each creation route and can be used for identification</p></li>
</ul>
<p>In almost every case, will want to follow template given in documentation <a class="footnote-reference brackets" href="#id16" id="id14">8</a>.</p>
<dl class="footnote brackets">
<dt class="label" id="id15"><span class="brackets"><a class="fn-backref" href="#id13">7</a></span></dt>
<dd><p><a class="reference external" href="https://docs.scipy.org/doc/numpy-1.12.0/user/basics.subclassing.html">https://docs.scipy.org/doc/numpy-1.12.0/user/basics.subclassing.html</a></p>
</dd>
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id14">8</a></span></dt>
<dd><p><a class="reference external" href="https://docs.scipy.org/doc/numpy-1.12.0/user/basics.subclassing.html#slightly-more-realistic-example-attribute-added-to-existing-array">https://docs.scipy.org/doc/numpy-1.12.0/user/basics.subclassing.html#slightly-more-realistic-example-attribute-added-to-existing-array</a></p>
</dd>
</dl>
</section>
<section id="pickling-ndarray-subclasses">
<h3>Pickling ndarray subclasses<a class="headerlink" href="#pickling-ndarray-subclasses" title="Permalink to this headline">¶</a></h3>
<p>When unpickling class instance, pickle protocol does not call <code class="docutils literal notranslate"><span class="pre">__init__</span></code> but rather creates uninitialized instance and then populated attributes from <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> <a class="footnote-reference brackets" href="#id19" id="id17">9</a>. As such, complex creation procedure required for ndarray subclasses fails to store additional class attributes.</p>
<p>Solution is to override ndarray <code class="docutils literal notranslate"><span class="pre">__reduce__</span></code> and <code class="docutils literal notranslate"><span class="pre">__setstate__</span></code> methods to explicitly store and retrieve (respectively) the added attributes <a class="footnote-reference brackets" href="#id20" id="id18">10</a>. N.b. Use <code class="docutils literal notranslate"><span class="pre">__reduce__</span></code> rather than <code class="docutils literal notranslate"><span class="pre">__getstate__</span></code> as is what is used by ndarray.</p>
<dl class="footnote brackets">
<dt class="label" id="id19"><span class="brackets"><a class="fn-backref" href="#id17">9</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3.4/library/pickle.html?highlight=pickle#pickling-class-instances">https://docs.python.org/3.4/library/pickle.html?highlight=pickle#pickling-class-instances</a></p>
</dd>
<dt class="label" id="id20"><span class="brackets"><a class="fn-backref" href="#id18">10</a></span></dt>
<dd><p><a class="reference external" href="https://stackoverflow.com/questions/26598109/preserve-custom-attributes-when-pickling-subclass-of-numpy-array">https://stackoverflow.com/questions/26598109/preserve-custom-attributes-when-pickling-subclass-of-numpy-array</a></p>
</dd>
</dl>
</section>
</section>
<section id="subclassing-builtin-types">
<h2>Subclassing builtin types<a class="headerlink" href="#subclassing-builtin-types" title="Permalink to this headline">¶</a></h2>
<p>Reasons why you shouldn’t immediately subclass Python built-in types <a class="footnote-reference brackets" href="#id22" id="id21">11</a></p>
<dl class="footnote brackets">
<dt class="label" id="id22"><span class="brackets"><a class="fn-backref" href="#id21">11</a></span></dt>
<dd><p><a class="reference external" href="https://stackoverflow.com/questions/25328448/should-i-subclass-python-list-or-create-class-with-list-as-attribute#answer-25328940">https://stackoverflow.com/questions/25328448/should-i-subclass-python-list-or-create-class-with-list-as-attribute#answer-25328940</a></p>
</dd>
</dl>
</section>
<section id="bokeh-plotting-library">
<h2>Bokeh Plotting Library<a class="headerlink" href="#bokeh-plotting-library" title="Permalink to this headline">¶</a></h2>
<section id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>“The architecture of Bokeh is such that high-level “model objects” (representing things like plots, ranges, axes, glyphs, etc.) are created in Python, and then converted to a JSON format that is consumed by the client library, BokehJS”</p>
<p class="attribution">—<a class="reference external" href="http://bokeh.pydata.org/en/latest/docs/user_guide/server.html">Bokeh Website</a></p>
</div></blockquote>
<p>As the data, etc is passed once to BokehJS, it can be explored but is otherwise static. The Bokeh server can help here:</p>
<blockquote>
<div><p>“However, if it were possible to keep the “model objects” in python and in the browser in sync with one another, then more additional and powerful possibilities immediately open up:</p>
<ul class="simple">
<li><p>respond to UI and tool events generated in a browser with computations or queries using the full power of python</p></li>
<li><p>automatically push updates the UI (i.e. widgets or plots), in a browser</p></li>
<li><p>use periodic, timeout, and asynchronous callbacks drive streaming updates</p></li>
</ul>
<p>This capability to synchronize between python and the browser is the main purpose of the Bokeh Server.”</p>
<p class="attribution">—<a class="reference external" href="http://bokeh.pydata.org/en/latest/docs/user_guide/server.html">Bokeh Website</a></p>
</div></blockquote>
</section>
<section id="current-status">
<h3>Current Status<a class="headerlink" href="#current-status" title="Permalink to this headline">¶</a></h3>
<p>Bokeh is a nice way of generating explorable plots for embedding into log files, etc. Would provide mush richer experience than current MPL to SVG approach.</p>
<p>Furthermore, looks like a great way of building GUI for data analysis/exploration — leverage Python for data processing/analysis and leave display/UI to HTML/JS. Seems more forward-looking and interoperable than relying on native canvases such as GTK.</p>
<p>Unfortunately, would say that Bokeh needs to mature slightly before it can replace MPL as default plotting library. Simple 2D plots (lines, bars, etc) look great, but more complex 2D plots (e.g. heatmaps, contours, etc) are still in early stages. These are the ones we will need the most for plotting 2DES datasets. Heatmap is probably closest contender, but does not interpolate. Also, 3D plots are currently completely missing and can currently only be handled by <a class="reference external" href="https://demo.bokehplots.com/apps/surface3d">interfacing 3rd party libs with Bokeh servers</a>.</p>
</section>
</section>
<section id="ctypes-pointers">
<h2>ctypes Pointers<a class="headerlink" href="#ctypes-pointers" title="Permalink to this headline">¶</a></h2>
<p>Pointer summary:</p>
<dl class="simple">
<dt>ctypes.POINTER():</dt><dd><p>Factory method. Returns callable which creates pointer of a particular ctypes type</p>
</dd>
<dt>ctypes.pointer():</dt><dd><p>Returns pointer object. Equivalent to (POINTER(&lt;type&gt;))(). N.b. this is a fully fledged Python object instance, not just a memory address as expected in C</p>
</dd>
<dt>ctypes.byref():</dt><dd><p>Returns a lightweight pointer object to the requested ctypes type. This is also a fully fledged Python object instance, albeit one which only really contains the address of the requested type.</p>
</dd>
<dt>ctypes.addressof():</dt><dd><p>Returns the memory addresss of the object as an integer. As low as you can go</p>
</dd>
</dl>
<p>Full details: <a class="reference external" href="http://stackoverflow.com/questions/9126031/python-ctypes-sending-pointer-to-structure-as-parameter-to-native-library">http://stackoverflow.com/questions/9126031/python-ctypes-sending-pointer-to-structure-as-parameter-to-native-library</a></p>
</section>
<section id="matplotlib">
<h2>matplotlib<a class="headerlink" href="#matplotlib" title="Permalink to this headline">¶</a></h2>
<section id="updating">
<h3>Updating<a class="headerlink" href="#updating" title="Permalink to this headline">¶</a></h3>
<p>Ubuntu package is old (MPL 1.3.x). Update instead with pip3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<p>Required a few dependencies however which pip couldn’t handle, viz. <code class="docutils literal notranslate"><span class="pre">libpng</span></code>, <code class="docutils literal notranslate"><span class="pre">freetype</span></code>. Install dev packages manually first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libpng12</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libfreetype6</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>Now pip works fine</p>
<p>Finally, when using GTK3 canvas, must also install <code class="docutils literal notranslate"><span class="pre">cairocffi</span></code> in order to provide GTK with necessary Cairo wrappers. This in turn had it’s own dependencies, viz; <code class="docutils literal notranslate"><span class="pre">python3.4-dev</span></code>, <code class="docutils literal notranslate"><span class="pre">libffi-dev</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python3</span><span class="mf">.4</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>and now install <code class="docutils literal notranslate"><span class="pre">cairocffi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="n">cairocffi</span>
</pre></div>
</div>
<p>N.b. <code class="docutils literal notranslate"><span class="pre">cairocffi</span></code> is required for all GTK3 backends (i.e. GTK3Cairo and GTK3Agg). It just doesn’t work without it!</p>
<p>More backend installation details: <a class="reference external" href="http://matplotlib.org/users/installing.html">http://matplotlib.org/users/installing.html</a>
cairocffi installation details: <a class="reference external" href="https://pythonhosted.org/cairocffi/overview.html#installing-cffi">https://pythonhosted.org/cairocffi/overview.html#installing-cffi</a></p>
</section>
<section id="backends">
<h3>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h3>
<p>Recall: backend is renderer/canvas combination - renderers are static (produce files); renderers + canvas are interactive (windows).</p>
<p>Previously using AGG renderer with Tk canvas. AGG write PNG only and is quite old (last repo update in 2006!). Probably better to move to Cairo - more output formats and newer.</p>
<p>Whilst we’re at it, let’s also try out GTK canvas - probably a bit newer (and already installed)</p>
<p>Change backend in <a class="reference external" href="~/.config/matplotlib/matplotlibrc">~/.config/matplotlib/matplotlibrc</a></p>
<p>Full details: <a class="reference external" href="http://matplotlib.org/faq/usage_faq.html#what-is-a-backend">http://matplotlib.org/faq/usage_faq.html#what-is-a-backend</a></p>
</section>
<section id="animation-output">
<h3>Animation Output<a class="headerlink" href="#animation-output" title="Permalink to this headline">¶</a></h3>
<p>Using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ani</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">Animation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>Animated GIF using Imagemagick (usually installed):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;prova.gif&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s2">&quot;Imagemagick&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>MP4 (and other video formats) require <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code>. <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> being merged into main ubuntu multimedia PPA, but only from Wiley onwards. Only require binary however, so downloaded static build of 3.0.2 from <a class="reference external" href="http://johnvansickle.com/ffmpeg/">http://johnvansickle.com/ffmpeg/</a> and placed in <code class="docutils literal notranslate"><span class="pre">/usr/bin</span></code>. Now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;prova.mp4&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s2">&quot;ffmpeg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Also provides writing to h264 (HTML5 video) format. This is done by embedding animation in video tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;prova.html&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ani</span><span class="o">.</span><span class="n">to_html5_video</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="svg-output">
<h3>SVG Output<a class="headerlink" href="#svg-output" title="Permalink to this headline">¶</a></h3>
<p>When generating SVGs from MPL, miter limit SVG property is set to a stupidly high value, causing Inkscape to crash hard <a class="footnote-reference brackets" href="#id26" id="id24">12</a> <a class="footnote-reference brackets" href="#id27" id="id25">13</a>.</p>
<p>Solution is to manually edit generated SVG and change miter limit down to something more manageable (e.g. 4)</p>
<dl class="footnote brackets">
<dt class="label" id="id26"><span class="brackets"><a class="fn-backref" href="#id24">12</a></span></dt>
<dd><p><a class="reference external" href="https://bugs.launchpad.net/inkscape/+bug/1533058">https://bugs.launchpad.net/inkscape/+bug/1533058</a></p>
</dd>
<dt class="label" id="id27"><span class="brackets"><a class="fn-backref" href="#id25">13</a></span></dt>
<dd><p><a class="reference external" href="https://bugs.launchpad.net/inkscape/+bug/1534376">https://bugs.launchpad.net/inkscape/+bug/1534376</a></p>
</dd>
</dl>
</section>
</section>
<section id="scipy">
<h2>SciPy<a class="headerlink" href="#scipy" title="Permalink to this headline">¶</a></h2>
<section id="upgrading-scipy-components-on-linux">
<h3>Upgrading SciPy Components on Linux<a class="headerlink" href="#upgrading-scipy-components-on-linux" title="Permalink to this headline">¶</a></h3>
<p>Do from pip. For user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="o">&lt;</span><span class="n">PACKAGE</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<p>or systemwide (naughty):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pip3</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">PACKAGE</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<p>In both cases, if using PyDev must remove and readd interpreter for changes to take effect.</p>
</section>
<section id="installing-scipy-on-windows">
<h3>Installing SciPy on Windows<a class="headerlink" href="#installing-scipy-on-windows" title="Permalink to this headline">¶</a></h3>
<p>Whilst can install numpy using pip and PyPI packages, same does not work for rest of SciPy stack:</p>
<blockquote>
<div><p>pip does not work well for Windows because the standard pip package index site, PyPI, does not yet have Windows wheels for some packages, such as SciPy.</p>
<p class="attribution">—Installing SciPy Stack, <a class="reference external" href="https://www.scipy.org/install.html">scipy.org</a></p>
</div></blockquote>
<p>Instead, should use excellent pre-built installers provided by Christoph Gohlke <a class="footnote-reference brackets" href="#id31" id="id28">14</a>.</p>
<p>Check wheel versions supported by pip <a class="footnote-reference brackets" href="#id32" id="id29">15</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pip</span><span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="n">pip</span><span class="o">.</span><span class="n">pep425tags</span><span class="o">.</span><span class="n">get_supported</span><span class="p">())</span>
</pre></div>
</div>
<p>Download correct wheels for numpy and scipy, then install using pip <a class="footnote-reference brackets" href="#id33" id="id30">16</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;.</span><span class="n">whl</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">scipy</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;.</span><span class="n">whl</span>
</pre></div>
</div>
<p>N.b. should use a numpy wheel linked to the Interl Math Kernel library — standard library for mathematical computations</p>
<dl class="footnote brackets">
<dt class="label" id="id31"><span class="brackets"><a class="fn-backref" href="#id28">14</a></span></dt>
<dd><p><a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a></p>
</dd>
<dt class="label" id="id32"><span class="brackets"><a class="fn-backref" href="#id29">15</a></span></dt>
<dd><p><a class="reference external" href="http://stackoverflow.com/questions/28107123/cannot-install-numpy-from-wheel-format">http://stackoverflow.com/questions/28107123/cannot-install-numpy-from-wheel-format</a></p>
</dd>
<dt class="label" id="id33"><span class="brackets"><a class="fn-backref" href="#id30">16</a></span></dt>
<dd><p><a class="reference external" href="https://pip.pypa.io/en/latest/user_guide/#installing-from-wheels">https://pip.pypa.io/en/latest/user_guide/#installing-from-wheels</a></p>
</dd>
</dl>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Marcelo Alcocer

    </p>
  </div>
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>